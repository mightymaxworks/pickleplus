<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pickle+ Platform</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    :root {
      --pickle-green: #38a169;
      --pickle-light: #f0fff4;
    }
    .bg-pickle-green { background-color: var(--pickle-green); }
    .text-pickle-green { color: var(--pickle-green); }
    .border-pickle-green { border-color: var(--pickle-green); }
    .hover-pickle-green:hover { background-color: var(--pickle-green); }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Navigation -->
  <nav class="bg-white shadow-sm py-3">
    <div class="container mx-auto px-4 flex justify-between items-center">
      <div class="flex items-center">
        <div class="text-2xl font-bold text-pickle-green">Pickle+</div>
      </div>
      <div class="flex space-x-6">
        <a href="/" class="text-gray-700 hover:text-pickle-green font-medium">Home</a>
        <a href="/matches" class="text-gray-700 hover:text-pickle-green font-medium">Matches</a>
        <a href="/leaderboard" class="text-gray-700 hover:text-pickle-green font-medium">Leaderboard</a>
        <a href="/tournaments" class="text-gray-700 hover:text-pickle-green font-medium">Tournaments</a>
      </div>
      <div>
        <a href="/profile" class="flex items-center space-x-2">
          <div class="w-8 h-8 rounded-full bg-pickle-green text-white flex items-center justify-center font-semibold">
            U
          </div>
          <span class="text-gray-700 font-medium" id="username">User</span>
        </a>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <div class="container mx-auto px-4 py-8">
    <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
      <h1 class="text-3xl font-bold text-pickle-green mb-2">Welcome to Pickle+</h1>
      <p class="text-gray-600">The premier platform for pickleball players to track matches, join tournaments, and connect with the community.</p>
    </div>

    <!-- Main Content -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      
      <!-- Leaderboard Card -->
      <div class="bg-white rounded-lg shadow-sm p-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold">Leaderboard</h2>
          <a href="/leaderboard" class="text-sm text-pickle-green hover:underline">View all</a>
        </div>
        <div class="space-y-3" id="leaderboard-container">
          <p class="text-gray-500 text-center py-4">Loading leaderboard data...</p>
        </div>
      </div>
      
      <!-- Recent Matches Card -->
      <div class="bg-white rounded-lg shadow-sm p-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold">Recent Matches</h2>
          <a href="/matches" class="text-sm text-pickle-green hover:underline">View all</a>
        </div>
        <div class="space-y-3" id="matches-container">
          <p class="text-gray-500 text-center py-4">Loading match data...</p>
        </div>
      </div>
      
      <!-- Upcoming Tournaments Card -->
      <div class="bg-white rounded-lg shadow-sm p-6">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-semibold">Tournaments</h2>
          <a href="/tournaments" class="text-sm text-pickle-green hover:underline">View all</a>
        </div>
        <div class="space-y-3" id="tournaments-container">
          <p class="text-gray-500 text-center py-4">Loading tournament data...</p>
        </div>
      </div>
    </div>
    
    <!-- Status Section -->
    <div class="mt-8 bg-white rounded-lg shadow-sm p-6">
      <h2 class="text-xl font-semibold mb-4">System Status</h2>
      <div id="status-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div class="bg-gray-50 p-4 rounded border">
          <div class="text-sm font-medium text-gray-500">API Status</div>
          <div id="api-status" class="mt-1 font-semibold">Checking...</div>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <div class="text-sm font-medium text-gray-500">Database</div>
          <div id="db-status" class="mt-1 font-semibold">Checking...</div>
        </div>
        <div class="bg-gray-50 p-4 rounded border">
          <div class="text-sm font-medium text-gray-500">Port</div>
          <div id="port-status" class="mt-1 font-semibold">Checking...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-white mt-12 py-8 border-t">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between">
        <div>
          <h3 class="text-xl font-bold text-pickle-green">Pickle+</h3>
          <p class="text-gray-600 mt-2">The platform for pickleball enthusiasts</p>
        </div>
        <div class="mt-4 md:mt-0">
          <div class="flex space-x-6">
            <a href="/" class="text-gray-600 hover:text-pickle-green">Home</a>
            <a href="/matches" class="text-gray-600 hover:text-pickle-green">Matches</a>
            <a href="/leaderboard" class="text-gray-600 hover:text-pickle-green">Leaderboard</a>
            <a href="/api/health" class="text-gray-600 hover:text-pickle-green">API Health</a>
          </div>
        </div>
      </div>
      <div class="mt-8 border-t border-gray-200 pt-4 text-gray-500 text-sm">
        &copy; 2025 Pickle+. All rights reserved.
      </div>
    </div>
  </footer>

  <script>
    // Fetch user data
    fetch('/api/auth/current-user')
      .then(response => {
        if (response.ok) return response.json();
        throw new Error('Not authenticated');
      })
      .then(userData => {
        document.getElementById('username').textContent = userData.username || 'User';
      })
      .catch(error => {
        console.log('User not authenticated:', error);
      });
    
    // Fetch leaderboard data
    fetch('/api/leaderboard')
      .then(response => response.json())
      .then(data => {
        const container = document.getElementById('leaderboard-container');
        if (data && data.length > 0) {
          container.innerHTML = '';
          data.slice(0, 5).forEach(player => {
            container.innerHTML += `
              <div class="flex justify-between items-center border-b border-gray-100 py-2">
                <span class="font-medium">${player.name}</span>
                <span class="bg-gray-100 px-2 py-1 rounded text-sm">${player.wins}-${player.losses}</span>
              </div>
            `;
          });
        } else {
          container.innerHTML = '<p class="text-gray-500 text-center py-4">No leaderboard data available</p>';
        }
      })
      .catch(error => {
        console.error('Error fetching leaderboard:', error);
        document.getElementById('leaderboard-container').innerHTML = 
          '<p class="text-red-500 text-center py-4">Error loading leaderboard</p>';
      });
      
    // Fetch match history
    fetch('/api/match/history')
      .then(response => response.json())
      .then(data => {
        const container = document.getElementById('matches-container');
        if (data && data.length > 0) {
          container.innerHTML = '';
          data.slice(0, 5).forEach(match => {
            const date = new Date(match.created_at).toLocaleDateString();
            container.innerHTML += `
              <div class="border-b border-gray-100 py-2">
                <div class="flex justify-between">
                  <span class="font-medium">${match.winner_username}</span>
                  <span class="font-medium">${match.winner_score}</span>
                </div>
                <div class="flex justify-between text-gray-500">
                  <span>${match.loser_username}</span>
                  <span>${match.loser_score}</span>
                </div>
                <div class="text-xs text-gray-400 mt-1">${date}</div>
              </div>
            `;
          });
        } else {
          container.innerHTML = '<p class="text-gray-500 text-center py-4">No match data available</p>';
        }
      })
      .catch(error => {
        console.error('Error fetching matches:', error);
        document.getElementById('matches-container').innerHTML = 
          '<p class="text-red-500 text-center py-4">Error loading matches</p>';
      });
      
    // Fetch tournaments
    fetch('/api/tournaments')
      .then(response => response.json())
      .then(data => {
        const container = document.getElementById('tournaments-container');
        if (data && data.length > 0) {
          container.innerHTML = '';
          data.slice(0, 3).forEach(tournament => {
            const startDate = new Date(tournament.start_date).toLocaleDateString();
            container.innerHTML += `
              <div class="border-b border-gray-100 py-2">
                <div class="font-medium">${tournament.name}</div>
                <div class="text-sm text-gray-600">${tournament.location}</div>
                <div class="flex justify-between mt-1">
                  <span class="text-xs text-gray-400">${startDate}</span>
                  <span class="text-xs bg-gray-100 px-2 py-0.5 rounded-full">${tournament.participant_count} players</span>
                </div>
              </div>
            `;
          });
        } else {
          container.innerHTML = '<p class="text-gray-500 text-center py-4">No tournaments available</p>';
        }
      })
      .catch(error => {
        console.error('Error fetching tournaments:', error);
        document.getElementById('tournaments-container').innerHTML = 
          '<p class="text-red-500 text-center py-4">Error loading tournaments</p>';
      });

    // Check API health
    fetch('/api/health')
      .then(response => response.json())
      .then(data => {
        console.log('API Health:', data);
        document.getElementById('api-status').textContent = 'Connected';
        document.getElementById('api-status').classList.add('text-green-600');
        
        document.getElementById('db-status').textContent = data.database === 'connected' ? 'Connected' : 'Not Connected';
        document.getElementById('db-status').classList.add(data.database === 'connected' ? 'text-green-600' : 'text-yellow-600');
        
        document.getElementById('port-status').textContent = data.port;
        document.getElementById('port-status').classList.add('text-green-600');
      })
      .catch(error => {
        console.error('Error checking API health:', error);
        document.getElementById('api-status').textContent = 'Error';
        document.getElementById('api-status').classList.add('text-red-600');
      });
  </script>
</body>
</html>
